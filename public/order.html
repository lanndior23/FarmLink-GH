<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FarmLink GH ‚Äì Order Crops</title>
  <link rel="stylesheet" href="css/order.css"/>
  <link rel="icon" href="/assets/icon.ico" />

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="firebase/config.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f7f9fb;
      padding: 20px;
      color: #333;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    #cropList {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .crop-card {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.2s ease;
    }

    .crop-card:hover {
      transform: scale(1.02);
    }

    .crop-name {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }

    .order-btn {
      background-color: #007b5e;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s ease;
    }

    .order-btn:hover {
      background-color: #005f47;
    }
  </style>
</head>
<body>
  <h2>üì¶ Order Available Crops</h2>
  <div id="cropList"></div>

  <script>
    const crops = [
      "Maize", "Rice", "Millet", "Sorghum",
      "Cassava", "Yam", "Cocoyam", "Sweet Potato",
      "Plantain", "Banana", "Mango", "Pineapple", "Papaya", "Orange", "Watermelon", "Avocado", "Coconut",
      "Tomatoes", "Garden Eggs", "Okra", "Pepper", "Cabbage", "Carrots", "Onion", "Lettuce", "Cucumber",
      "Groundnut", "Cowpea", "Soybean",
      "Cocoa", "Oil Palm", "Coffee", "Cotton", "Rubber", "Shea Nuts",
      "Ginger", "Garlic", "Turmeric", "Basil", "Mint"
    ];

    const cropList = document.getElementById('cropList');
    let currentUser = null;

    firebase.auth().onAuthStateChanged(async user => {
      if (!user) {
        alert("Please log in to place orders.");
        window.location.href = "login.html";
        return;
      }

      currentUser = user;

      crops.forEach(crop => {
        const card = document.createElement('div');
        card.className = 'crop-card';

        const cropNameElem = document.createElement('div');
        cropNameElem.className = 'crop-name';
        cropNameElem.textContent = crop;

        const orderBtn = document.createElement('button');
        orderBtn.className = 'order-btn';
        orderBtn.textContent = 'Place Order';
        orderBtn.addEventListener('click', () => placeOrder(crop));

        card.appendChild(cropNameElem);
        card.appendChild(orderBtn);
        cropList.appendChild(card);
      });
    });

    async function placeOrder(cropName) {
      if (!currentUser) return;

      try {
        const order = {
          buyerName: currentUser.displayName || "Unknown Buyer",
          buyerId: currentUser.uid,
          crop: cropName,
          status: "Pending",
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };

        await firebase.firestore().collection("orders").add(order);
        alert(`‚úÖ Order placed for ${cropName}`);
      } catch (err) {
        console.error("Order error:", err);
        alert("‚ùå Failed to place order. Try again.");
      }
    }
  </script>
</body>
</html>
